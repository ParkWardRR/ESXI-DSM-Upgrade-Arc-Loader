# Proxmox DSM Guide

This guide assists you in installing DSM 7 on the Proxmox hypervisor and transitioning from DSM 6 to DSM 7 on Proxmox. While this guide is untested, it is adapted from the ESXI-DSM-Upgrade-Arc-Loader method. 

You can also refer to this guide: https://github.com/AuxXxilium/AuxXxilium/wiki

[![image.png](https://i.postimg.cc/B6y2Q23Y/image.png)](https://postimg.cc/ftcV8tJm)

## Prerequisites

- Ensure you download the `arc-*.vmdk-dyn.zip` file from the [appropriate source](https://github.com/AuxXxilium/arc/releases) before you begin.

## Equipment

- Proxmox host

# SECTION 1: Configuring and Launching the Proxmox VM running DSM 7

Follow these steps to configure the setup:

1. **Import the .vmdk file**: Use the Proxmox web GUI to move the `.vmdk` file to your Proxmox host.

2. **Convert the VMDK to a QCOW2 image**: Proxmox uses a different VM image format (QCOW2). Use `qemu-img` to perform this conversion:

```bash
qemu-img convert -f vmdk -O qcow2 /path_to/arc-dyn.vmdk /destination_path/arc-dyn.qcow2
```

3. **Create a New VM and add another drive**: Launch Proxmox and click on the create VM button. During the VM creation, make sure to add an additional drive which will be used for the DSM OS installation.

4. **Select "Do not use any media"**: Click the 'OS' tab during VM creation and choose "Do not use any media".

5. **Remove the SCSI0 Disk**: Click the 'Disks' tab and erase the existing SCSI0 disk.

6. **Link the Converted Drive**: In the 'Disks' tab, link the  `.qcow2` image from the earlier conversion step as a new SATA drive.

7. **Modify the Boot Order**: Press the 'Options' button, click 'Boot Order' and Edit. Disable all options except SATA0 and validate with 'OK'. 

8. **Initiate the VM**: Launch the newly created VM.

# SECTION 2: Configuring Arc Loader and Connecting Storage Drives

Proceed with the following to optimize Arc Loader:

1. **Set Up Arc's Drive Mapper**: Set drive mapper settings of Arc to either "auto" or "active". This adjustment ensures that the Arc Loader operates optimally during the DSM 7 installation.

2. **Choose a Model Number**: Refer to the Arc guide and select a model compatible with Arc. This choice depends on various factors including aesthetics, hardware support, and the number of threads you need. For example, if you need a rack-mounted DAS aesthetic, go for RS4021xs+.
   
3. **Use Autogenerated MAC and Serial Number**: In this guide, we opted for the auto-generate function for the MAC and Serial Number.

4. **Start DSM 7 Installation**: Proceed with installing DSM 7 using Arc.

5. **Confirm DSM 7 Installation**: Ensure DSM 7 has been properly installed and is running as expected.

6. **Add your NAS storage drives and/or HBA/DAS**: Now that you have confirmed the installation, connect your NAS storage drives or any other Hardware Based RAID/Host Bus Adapter (HBA/DAS) systems. (shutdown vm as needed) After connecting these, run the Arc mapper again for optimal setup configuration.

# SECTION 3: Migration from DSM 6 to DSM 7

Transition from DSM 6 to DSM 7 using these steps:

1. **Shutdown the DSM 6 VM**: Halt the DSM 6 VM to prevent conflicts with the DSM 7 instance.

2. **Move PCIe passthrough**: Transfer the host bus adapter's PCIe passthrough from DSM 6 to your newly installed DSM 7 VM.

3. **Reboot the DSM 7 VM using Arc**: Restart the DSM 7 VM and boot it with the Arc loader.

4. **Alter Arc's drive mapper**: Change Arc's drive mapper setting to "active" to ensure your drive paths are mapped correctly.

5. **Launch DSM 7**: Once you have configured your setup, boot DSM 7 and verify it operates as intended.

6. **Retrieve your storage pools**: Finally, safely restore your saved datasets and storage structures so the new system can access all the previous data as per your setup requirements.

---

Encounter problems? Feel free to raise a ticket on this repository. We appreciate your feedback and will revise the guide as needed.

---
Xpenology
