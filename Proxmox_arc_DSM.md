# Proxmox DSM Guide

The guide walks you through installing DSM 7 on the Proxmox hypervisor and migrating from DSM 6 to DSM 7 on Proxmox. This guide, though untested, is adapted from the ESXI-DSM-Upgrade-Arc-Loader method. 

Also take a look at this guide: https://github.com/AuxXxilium/AuxXxilium/wiki

## Prerequisites

- Do not forget to download the `arc-*.vmdk-dyn.zip` file from the [appropriate source](https://github.com/AuxXxilium/arc/releases) before starting.

## Equipment

- Proxmox host

# SECTION 1: Configuring and Launching the Proxmox VM running DSM 7

The following steps guide you through the configuration process:

1. **Import the .vmdk file**: Use the Proxmox web GUI to import the `.vmdk` file to your Proxmox host.

2. **Convert the VMDK to a QCOW2 image**: Proxmox uses a different VM image format called QCOW2. With `qemu-img` to convert the VMDK to a QCOW2 image using this command:

```bash
qemu-img convert -f vmdk -O qcow2 /path_to/arc-dyn.vmdk /destination_path/arc-dyn.qcow2
```

3. **Create a New VM**: Open Proxmox and navigate to the create VM button.

4. **Select "Do not use any media"**: While creating the VM, go into the 'OS' tab and select "Do not use any media".

5. **Delete the SCSI0 Disk**: Navigate to the 'Disks' tab and delete the existing SCSI0 disk.

6. **Attach the Converted Drive**: Within the 'Disks' tab, attach the  `.qcow2` image from the conversion step as a new SATA drive.

7. **Change Boot Order**: Go to the 'Options' menu, select 'Boot Order' and Edit. Uncheck all options except SATA0 and confirm with 'OK'. 

8. **Power on the VM**: Boot the newly created VM.

# SECTION 2: Configuring Arc Loader

Ensure Arc Loader works optimally with the following steps:

1. **Set Up Arc's Drive Mapper**: Configure the drive mapper settings of Arc to either "auto" or "active". This adjustment is crucial to ensuring the Arc Loader works efficiently during the DSM 7 installation process.

2. **Choose a Model Number**: Refer to the Arc guide and pick a model that supports Arc. For the aesthetic of a rack-mounted DAS, I have chosen the RS4021xs+. Be sure to select a model that aligns with the number of threads and need for NVMe and other accelerators you require. You can refer to this list for the information: [Arc: Model List for Arc](https://github.com/AuxXxilium/AuxXxilium/wiki/Arc:-Model-List-for-Arc)
   
3. **Opt for Autogenerated MAC and Serial Number**: For this guide, I decided to use the auto-generate feature for my MAC and Serial Number.

4. **Begin DSM 7 Installation**: Move onto installing DSM 7 using Arc.



# SECTION 3: Migration from DSM 6 to DSM 7

Follow this sequence to migrate from DSM 6 to DSM 7:

1. **Shutdown the DSM 6 VM**: Halt the DSM 6 VM to avoid conflicts with the DSM 7 instance.

2. **Transfer PCIe passthrough**: Move the host bus adapter's PCIe passthrough from the DSM 6 to your freshly installed DSM 7 VM.

3. **Boot the DSM 7 VM to Arc**: Now, reboot the DSM 7 VM and boot it using the Arc loader.

4. **Adjust Arc's drive mapper**: Swap Arc's drive mapper setting to "active" ensuring the correct mapping of your drive paths.

5. **Boot DSM 7**: After configuring your setup, launch DSM 7 and verify its functionality.

6. **Restore your storage pools**: Finally, safety restore your storage structures and saved datasets for the newly installed system to access all the previous data as per your setup requirements.

---

In case of any issues, feel free to raise a ticket on this repository. We value your feedback and will update the guide as required.

---
Xpenology
